plugins {
    id 'java'
    id 'org.asciidoctor.jvm.convert' version '3.3.2'
}

group = 'ru.kindergarten'
version = "0.0.1-SNAPSHOT"

repositories {
    mavenCentral()
}

dependencies {
    testImplementation platform('org.junit:junit-bom:5.10.0')
    testImplementation 'org.junit.jupiter:junit-jupiter'
}

test {
    useJUnitPlatform()
}

asciidoctor {
    // –ü–∞–ø–∫–∞ —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    sourceDir = file('src/docs/asciidoc')
    // –ü–∞–ø–∫–∞, –∫—É–¥–∞ –∫–ª–∞–¥—ë—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML
    outputDir = file('docs/asciidoc')

    // –ê—Ç—Ä–∏–±—É—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ .adoc —Ñ–∞–π–ª–æ–≤
    attributes = [
            'project-name': 'Kindergarten Platform',
            'sourcedir'   : 'src/main/java',
            'imagesdir'   : 'images',
            'toc'         : 'left',   // —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å–ª–µ–≤–∞
            'toclevels'   : 3,        // –≥–ª—É–±–∏–Ω–∞ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è
            'numbered'    : true      // –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ü–∏–π
    ]

    // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–∞–º (–¥–ª—è include –∏ image)
    options = [
            safe: 'unsafe'
    ]

    // –ö–æ–ø–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    resources {
        from(sourceDir) {
            include 'images/**'
            include '**/*.png', '**/*.jpg', '**/*.jpeg', '**/*.gif', '**/*.svg'
        }
    }

    doFirst {
        println "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Asciidoctor-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
    }
}

// –î–æ–ø. –∑–∞–¥–∞—á–∞ ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å docs –≤ resources, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ jar
task copyDocs(type: Copy) {
    from asciidoctor.outputDir
    into 'build/resources/main/static/docs'
}

tasks.named('processResources') {
    dependsOn copyDocs
}

tasks.named('asciidoctor') {
    finalizedBy copyDocs
}